{% extends 'base.html' %}
{% load staticfiles %}
{% if user.is_authenticated %}
  {% load app_tags %}
{% endif %}
{% block title %}

   Home - {{ block.super }} 

{% endblock title %}

{% block content %}
<div id="vue-container">
  <nav class="dt w-100 border-box pa3 ph5-ns">
    <div class="dtc v-mid w-75 tr">
      <a class="link dark-gray f6 f5-ns dib mr3 mr4-ns" href="#" title="About">
        <div class="form-inline my-2 my-lg-0">
          <input class="form-control mr-sm-2" type="text" placeholder="Title contains" v-model="search_term">
          <button class="btn btn-outline-success my-2 my-sm-0 mr2" v-on:click.prevent="getPosts()">Search Posts</button>
          <input class="form-control mr-sm-2" type="text" placeholder="Username" v-model="username_search">
          <button class="btn btn-outline-success my-2 my-sm-0 mr2" v-on:click.prevent="getUsers()">Search Users</button>
        </div>
      </a>
      <a class="link dark-gray f6 f5-ns dib mr3 mr4-ns" href="#" title="Store">Temp</a>
      <a class="link dark-gray f6 f5-ns dib" href="#" title="Contact">Temp</a>
    </div>
  </nav>
  <div class="mw9 center ph3-ns">
    <div class="cf ph2-ns">
      <div class="fl w-25 pa2">
        <div class="outline bg-white pv4">
        {% comment %} Profile card {% endcomment %}
          <article class="mw5 center bg-white br3 pa3 pa4-ns mv3 ba b--black-10">
            <div class="tc">
              {% if user.is_authenticated %}
                <img src="{{ user|gravatar:50 }}" class="br-100 h3 w3 dib" title="Profile avatar">
              {% else %}
                <img src="{% static 'images/default_avatar.png' %}" class="br-100 h3 w3 dib" title="Profile avatar">
              {% endif %}
              <h1 class="f4">Mimi Whitehouse</h1>
              <hr class="mw3 bb bw1 b--black-10">
            </div>
            <p class="lh-copy measure center f6 black-70">
              Quite affectionate and outgoing.
              She loves <em>scritches</em> and will
              roll around on the floor waiting for you give her more of them.
            </p>
          </article>
        </div>
      </div>
      <div class="fl w-100 w-75-ns pa2" >
        <div v-show="!showPostsNotUsers" >
          <div v-if="users[0]"> 
            <article v-for="user in users" :key="user.pk">
              <form method="POST" v-on:submit.prevent="toggleFollow(user)">
                {% csrf_token %}
                <button type="submit" class="f6 grow no-underline br-pill ba ph3 pv1 dib mid-gray">Follow ${user.username}</button>
              </form>
            </article>
          </div>
        </div>
        <div v-show="showPostsNotUsers" class="outline bg-white pv4">
          <section class="mw7 center">
          {% comment %} Add a post through api {% endcomment %}
          <div>
            <div class="pv3 bt bb b--black-10 ph1 ph0-l">           
              <form method="POST" v-on:submit.prevent="addPost()">
                {% csrf_token %}
                <input type="text" v-model="newPost.text" maxlength="280" placeholder="Make your decree" required="required"/>
                <button type="submit" class="f6 grow no-underline br-pill ba ph3 pv1 dib mid-gray">Submit</button>
              </form>
            </div>
            {% comment %} Dynamically generated content {% endcomment %}
            <article v-for="post in posts" :key="post.pk" class="pv3 bt bb b--black-10 ph1 ph0-l">
              <div class="flex flex-column flex-row-ns">
                <div class="pl1-ns order-1 mb2 mb0-ns w-100 w-25-ns">
                  {% comment %} user avatar {% endcomment %}
                  <div class="tc">
                    {% if user.is_authenticated %}
                     <a href="{% url 'profile' %}"> <img src="{{ user|gravatar:50 }}" class="br-100 h3 w3 dib" title="Profile avatar"></a>
                    {% else %}
                      <img src="{% static 'images/default_avatar.png' %}" class="br-100 h3 w3 dib" title="Profile avatar">
                    {% endif %}
                    <div>
                      <a v-if="loggedInUser.pk === post.user.pk" @click.prevent="deletePost(post)"  class="f6 grow no-underline br-pill ba ph3 pv1 dib mid-gray" href="#0">Delete</a>
                      <a v-if="!loggedInUser.users_followed.includes(post.user.username)" @click.prevent="toggleFollow(post)" class="f6 grow no-underline br-pill ba ph3 pv1 dib mid-gray" href="#0">Follow ${post.user.username}</a>
                      <a v-if="post.post_response[0]" @click="toggle(post)"  class="f6 grow no-underline br-pill ba ph3 pv1 dib mid-gray" href="#0">Responses</a>
                    </div>
                  </div>
                </div>
                {% comment %} Tweets generated here {% endcomment %}
                <div class="w-100 w-70-ns mr1 br3 shadow-2 pa3 pr3-ns order-2">
                  <h1 class="f3 athelas mt0 lh-title">${post.text}</h1>
                  <p class="f6 ml2 lh-copy gray mv0">By <span class="ttu"><a href="#">${post.user.username}</a></span></p>
                  <time class="f6 ml2 db gray">${post.created_at}</time>
                </div>
              </div>
              {% comment %} Responses container {% endcomment %}
              <div v-if="activated(post)">
                <div v-for="response in post.post_response" class="mt1 ml4">
                  <div class="flex flex-column flex-row-ns">
                    <div class="pl1-ns order-1 mb2 mb0-ns w-100 w-25-ns">
                      {% comment %} small user avatar {% endcomment %}
                      <div class="tc">
                        {% if user.is_authenticated %}
                          <img src="{{ user|gravatar:50 }}" class="br-100 h3 w3 dib" title="Profile avatar">
                        {% else %}
                          <img src="{% static 'images/default_avatar.png' %}" class="br-100 h3 w3 dib" title="Profile avatar">
                        {% endif %}
                      </div>
                    </div>
                    {% comment %} Responses generated here {% endcomment %}
                    <div class="w-100 w-70-ns mr1 br3 shadow-2 pa3 pr3-ns order-2">
                      <h1 class="f3 athelas mt0 lh-title">${response.text}</h1>
                      <p class="f6 ml2 lh-copy gray mv0">By <span class="ttu"><a href="#">${response.user}</a> <small>on ${response.created_at}</small></span></p>
                    </div>
                  </div>
                </div>

              </article>
            </div>
          </section>
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock content %}
